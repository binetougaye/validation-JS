<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste Clients</title>

    <!-- Bootstrap CSS and Icon Link -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

</head>

<body>

    <table class="table">
        <thead>
            <tr>
                <th scope="col">Prenom</th>
                <th scope="col">Nom</th>
                <th scope="col">Email</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <!-- <script type="module">

    // import { initializeApp } from "firebase/app";
    // import { collection, getFirestore } from "firebase/firestore";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // TODO: Replace the following with your app's Firebase project configuration
    // See: https://support.google.com/firebase/answer/7015592
    const firebaseConfig = {
        apiKey: "AIzaSyAWpBSXZ0zYov-GkuQRl5vfiq9V6UkfsDE",
        authDomain: "validation-js-2024.firebaseapp.com",
        databaseURL: "https://validation-js-2024-default-rtdb.firebaseio.com",
        projectId: "validation-js-2024",
        storageBucket: "validation-js-2024.appspot.com",
        messagingSenderId: "565787116440",
        appId: "1:565787116440:web:d6eb3365dbd8c71d70a1ed",
        measurementId: "G-E3S1WFF6H2"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);


    // Initialize Cloud Firestore and get a reference to the service
    const db = getFirestore(app);
    const UserAutList = collection(db, "UserAutList")


    const docRef = doc(db, "UserAutList");
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
        console.log("Document data:", docSnap.data());
    } else {
        // docSnap.data() will be undefined in this case
        console.log("No such document!");
    }

    </script> -->

    <script type="module">

        let user = 0;
        let tbody = document.getElementById('tbody');

        function addItemToTable(nom, email, action) {
            let trow = document.createElement('tr');
            let td1 = document.createElement('td');
            let td2 = document.createElement('td');
            let td3 = document.createElement('td');
            let td4 = document.createElement('td');

            td1.innerHTML = ++user;
            td2.innerHTML = nom;
            td3.innerHTML = email;
            td4.innerHTML = action;

            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);
            trow.appendChild(td4);

            tbody.appendChild(trow);

        }


        function addAllItemToTable(users) {
            user = 0;
            tbody.innerHTML = '';
            users.forEach(element => {
                addItemToTable(element.firstname, element.lastname, element.email, element.action);
            });
        }


        // Firestore

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


        const firebaseConfig = {
            apiKey: "AIzaSyAWpBSXZ0zYov-GkuQRl5vfiq9V6UkfsDE",
            authDomain: "validation-js-2024.firebaseapp.com",
            databaseURL: "https://validation-js-2024-default-rtdb.firebaseio.com",
            projectId: "validation-js-2024",
            storageBucket: "validation-js-2024.appspot.com",
            messagingSenderId: "565787116440",
            appId: "1:565787116440:web:d6eb3365dbd8c71d70a1ed",
            measurementId: "G-E3S1WFF6H2"
        };


            // Initialize Firestore

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);


        // Firestore

        function getAllDataOnce() {
            const userAutListRef = collection(db, 'UserAutList');
            getDocs(userAutListRef)
                .then((querySnapshot) => {
                    let utilisateurs = [];

                    querySnapshot.forEach((doc) => {
                        utilisateurs.push(doc.data());
                    });

                    addAllItemToTable(utilisateurs);
                })
                .catch((error) => {
                    console.error("Error getting documents: ", error);
                });
        }



        // Recuperation des donnÃ©es en temps reel
        // function getAllDataRealTime() {
        //     const dbRef = ref(db, 'UserAutList');
            
        //     onValue(dbRef, (snapshot) => {
        //         let utilisateurs = [];

        //         snapshot.forEach(childSnapshot => {
        //             utilisateurs.push(childSnapshot.val())
        //         });

        //         addAllItemToTable(utilisateurs);
        //     })
        // }

        window.onload = getAllDataOnce;

        // allow read, write: if request.auth != null;

    </script>

</body>

</html>