<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin-Dashboard</title>

    <!-- Bootstrap CSS and Icon Link -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Custom CSS Link -->
    <link rel="stylesheet" href="adminDashboard.css">
    
</head>

<body>
    <div class="container-fluid d-flex">
        <section id="sidebar">
            <h1>Belle <br> Gueule</h1>
            <ul class="">
                <a href="adminDashboard.html"><i class="bi bi-house-fill"></i>Accueil</a>
                <a href="listeUtilisateur.html"><i class="bi bi-person-fill"></i>Liste des Utilisateurs</a>
                <a href="gestionProduitAdmin.html"><i class="bi bi-bag-fill"></i>Ajout des Articles</a>
                <a href="#"><i class="bi bi-tags-fill"></i>Ajout des Catégories</a>
            </ul>
            <button>Sign Out</button>
        </section>
        <section id="dashboard">
            <div class="row d-flex w-100 profile py-2">
                <img src="images/images.jpg" alt="avatar">
                <h6>Admin</h6>
            </div>
            <div class="row d-flex justify-content-around w-100 stats">
                <div class="card text-center pt-4">Nombre de Clients<br><span id="client"></span></div>
                <div class="card text-center pt-4">Nombre d'Admin</div>
                <div class="card text-center pt-4">Nombre d'Articles</div>
            </div>
            <div class="mt-5">
                <h1 class="text-center">Liste des utilisateurs</h1>
                <input type="text" id="searchbar" placeholder="Recherchez un prenom" onkeyup="filter()">
                <table class="table mt-3" id="tableau">
                    <thead>
                        <tr>
                            <!-- <th scope="col">N°</th> -->
                            <th scope="col">Prenom</th>
                            <th scope="col">Nom</th>
                            <th scope="col">Email</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <script type="module" src="adminDashboard.js"></script>
    <script>

        // Barre de Recherche

        function filter() {
                let filtre = document.getElementById('searchbar').value.toUpperCase()
                let ligne = document.getElementsByTagName('tr')

                for (let i = 0; i < ligne.length; i++) {
                    cellule = ligne[i].getElementsByTagName('td')[0];
                    if (cellule) {
                        let texte = cellule.innerText;
                        if (texte.toUpperCase().indexOf(filtre) > -1) {
                            ligne[i].style.display = '';
                        }
                        else {
                            ligne[i].style.display = 'none';
                        }
                    }
                }
            }
    </script>

                <!-- <script type="module">

                    let user = 0;
                    let tbody = document.getElementById('tbody');

                    function addItemToTable(prenom, nom, email, action) {
                        let trow = document.createElement('tr');
                        let td1 = document.createElement('td');
                        let td2 = document.createElement('td');
                        let td3 = document.createElement('td');
                        let td4 = document.createElement('td');
                        let td5 = document.createElement('td');

                        td1.innerHTML = ++user;
                        td2.innerHTML = prenom;
                        td3.innerHTML = nom;
                        td4.innerHTML = email;
                        td5.innerHTML = action;

                        trow.appendChild(td1);
                        trow.appendChild(td2);
                        trow.appendChild(td3);
                        trow.appendChild(td4);
                        trow.appendChild(td5);


                        td5.innerHTML = `<i class="bi bi-eye"></i> <i class="bi bi-trash3" id="test" "></i>`

                        tbody.appendChild(trow);

                        // Ajoute un écouteur d'événements sur le tableau lui-même
                        tbody.addEventListener('click', function (event) {
                            // Vérifie si l'élément cliqué est une icône de corbeille
                            if (event.target.classList.contains('bi-trash3')) {
                                // Supprime la ligne parente de l'icône de corbeille
                                let rowToRemove = event.target.closest('tr');
                                rowToRemove.remove();
                            }
                        });

                    }


                    function addAllItemToTable(users) {
                        user = 0;
                        tbody.innerHTML = '';
                        users.forEach(element => {
                            addItemToTable(element.firstname, element.lastname, element.email, element.action);
                        });
                    }

                    

                    // Firestore

                    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
                    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
                    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


                    const firebaseConfig = {
                        apiKey: "AIzaSyAWpBSXZ0zYov-GkuQRl5vfiq9V6UkfsDE",
                        authDomain: "validation-js-2024.firebaseapp.com",
                        databaseURL: "https://validation-js-2024-default-rtdb.firebaseio.com",
                        projectId: "validation-js-2024",
                        storageBucket: "validation-js-2024.appspot.com",
                        messagingSenderId: "565787116440",
                        appId: "1:565787116440:web:d6eb3365dbd8c71d70a1ed",
                        measurementId: "G-E3S1WFF6H2"
                    };


                    // Initialize Firestore

                    const app = initializeApp(firebaseConfig);
                    const analytics = getAnalytics(app);
                    const db = getFirestore(app);


                    // Firestore

                    function getAllDataOnce() {
                        const userAutListRef = collection(db, 'UserAutList');
                        getDocs(userAutListRef)
                            .then((querySnapshot) => {
                                let utilisateurs = [];

                                querySnapshot.forEach((doc) => {
                                    utilisateurs.push(doc.data());
                                });

                                addAllItemToTable(utilisateurs);
                                
                                // recuperation nombre d'utilisateurs
                                document.getElementById('client').innerHTML = utilisateurs.length
                            })
                            .catch((error) => {
                                console.error("Error getting documents: ", error);
                            });
                    }

                    // Recuperation des données en temps reel
                    // function getAllDataRealTime() {
                    //     const dbRef = ref(db, 'UserAutList');

                    //     onValue(dbRef, (snapshot) => {
                    //         let utilisateurs = [];

                    //         snapshot.forEach(childSnapshot => {
                    //             utilisateurs.push(childSnapshot.val())
                    //         });

                    //         addAllItemToTable(utilisateurs);
                    //     })
                    // }


                    

                    window.onload = getAllDataOnce;

                    // Regle firestore
                    // allow read, write: if request.auth != null;




                    // // Suppression d'un utilisateur
                    // let supp = document.getElementById('test')

                    // supp.addEventListener('click', function () {
                    
                    //     let toDel = trow.innerHTML;
                    //     toDel.innerHTML = '';
                    // })

                    


                        

                </script> -->
            

    <!-- Bootstrap JS link -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>