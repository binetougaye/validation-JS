<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin-Dashboard</title>

    <!-- Bootstrap CSS and Icon Link -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Custom CSS Link -->
    <link rel="stylesheet" href="adminDashboard.css">
</head>

<body>
    <div class="container-fluid d-flex pt-4">
        <section id="sidebar">
            <h1>Belle <br> Gueule</h1>
            <ul class="">
                <a href="adminDashboard.html"><i class="bi bi-house-fill"></i>Accueil</a>
                <a href="listeClient.html"><i class="bi bi-person-fill"></i>Liste des Utilisateurs</a>
                <a href="#"><i class="bi bi-bag-fill"></i>Ajout des Articles</a>
                <a href="#"><i class="bi bi-tags-fill"></i>Ajout des Catégories</a>
            </ul>
            <button>Sign Out</button>
        </section>
        <section id="dashboard">
            <div class="row d-flex justify-content-between">
                <div class="card text-center pt-4">Nombre d'Utilisateurs <br><span id="client"></span></div>
                <div class="card text-center pt-4">Nombre d'Admin</div>
                <div class="card text-center pt-4">Nombre d'Articles</div>
            </div>
            <div class="mt-5">
                <h1 class="text-center">Liste des utilisateurs</h1>
                <table class="table mt-3" id="tableau">
                    <thead>
                        <tr>
                            <th scope="col">N°</th>
                            <th scope="col">Prenom</th>
                            <th scope="col">Nom</th>
                            <th scope="col">Email</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            
                <script type="module">

                    let user = 0;
                    let tbody = document.getElementById('tbody');

                    function addItemToTable(prenom, nom, email, action) {
                        let trow = document.createElement('tr');
                        let td1 = document.createElement('td');
                        let td2 = document.createElement('td');
                        let td3 = document.createElement('td');
                        let td4 = document.createElement('td');
                        let td5 = document.createElement('td');

                        td1.innerHTML = ++user;
                        td2.innerHTML = prenom;
                        td3.innerHTML = nom;
                        td4.innerHTML = email;
                        td5.innerHTML = action;

                        trow.appendChild(td1);
                        trow.appendChild(td2);
                        trow.appendChild(td3);
                        trow.appendChild(td4);
                        trow.appendChild(td5);


                        td5.innerHTML = `<i class="bi bi-eye"></i> <i class="bi bi-trash3" onclick="deleteUser(this)"></i>`

                        tbody.appendChild(trow);

                    }


                    function addAllItemToTable(users) {
                        user = 0;
                        tbody.innerHTML = '';
                        users.forEach(element => {
                            addItemToTable(element.firstname, element.lastname, element.email, element.action);
                        });
                    }


                    // Firestore

                    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
                    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
                    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


                    const firebaseConfig = {
                        apiKey: "AIzaSyAWpBSXZ0zYov-GkuQRl5vfiq9V6UkfsDE",
                        authDomain: "validation-js-2024.firebaseapp.com",
                        databaseURL: "https://validation-js-2024-default-rtdb.firebaseio.com",
                        projectId: "validation-js-2024",
                        storageBucket: "validation-js-2024.appspot.com",
                        messagingSenderId: "565787116440",
                        appId: "1:565787116440:web:d6eb3365dbd8c71d70a1ed",
                        measurementId: "G-E3S1WFF6H2"
                    };


                    // Initialize Firestore

                    const app = initializeApp(firebaseConfig);
                    const analytics = getAnalytics(app);
                    const db = getFirestore(app);


                    // Firestore

                    function getAllDataOnce() {
                        const userAutListRef = collection(db, 'UserAutList');
                        getDocs(userAutListRef)
                            .then((querySnapshot) => {
                                let utilisateurs = [];

                                querySnapshot.forEach((doc) => {
                                    utilisateurs.push(doc.data());
                                });

                                addAllItemToTable(utilisateurs);
                                
                                // recuperation nombre d'utilisateurs
                                document.getElementById('client').innerHTML = utilisateurs.length
                            })
                            .catch((error) => {
                                console.error("Error getting documents: ", error);
                            });
                    }



                    // Recuperation des données en temps reel
                    // function getAllDataRealTime() {
                    //     const dbRef = ref(db, 'UserAutList');

                    //     onValue(dbRef, (snapshot) => {
                    //         let utilisateurs = [];

                    //         snapshot.forEach(childSnapshot => {
                    //             utilisateurs.push(childSnapshot.val())
                    //         });

                    //         addAllItemToTable(utilisateurs);
                    //     })
                    // }

                    window.onload = getAllDataOnce;

                    // Regle firestore
                    // allow read, write: if request.auth != null;



                    // // Recuperation du nombre d'utilisateurs
                    // let tableau = document.getElementById('tableau').rows.lenght
                    // // let test = tbody.rows.length;
                    // console.log(tableau);



                    // Suppression d'un utilisateur

                    function deleteUser(i) {
                        let ligneASupprimer = i.closest('tr');

                        if (ligneASupprimer) {
                            ligneASupprimer.remove();
                            // localStorage.removeItem('data');
                        }

                            // localStorage.clear('data')
                    }

                </script>
            
            </div>
        </section>
    </div>

    <!-- Bootstrap JS link -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>